<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Draw Wave Shape with Canvas</title>
  <style>
    body {
      width: 800px;
      margin: 0 auto;
      background: #333;
    }

    canvas {
      display: block;
      margin: 20px auto;
    }

    #range {
      display: block;
      margin: 0 auto;
      margin-top: 20px;
      width: 400px;
    }
  </style>
</head>
<body>

  <input type="range" id="range" min="0" max="1" step="0.01" />
  <script>
    function SiriWave(option) {
      this.option = option || {};

      this.K = 2;
      this.F = 6;
      this.speed = option.speed || 0.1;
      this.noise = option.noise || 0;
      this.phase = option.phase || 0;

      devicePixelRatio = devicePixelRatio || 1;
      this.width = devicePixelRatio * (option.width || 320);
      this.height = devicePixelRatio * (option.height || 100);
      this.MAX = (this.height / 2) - 4;

      var canvas = document.createElement('canvas');
      canvas.width = this.width;
      canvas.height = this.height;
      canvas.style.width = this.width / devicePixelRatio + 'px';
      canvas.style.height = this.height / devicePixelRatio + 'px';
      document.body.appendChild(canvas);

      this.canvas = canvas;
      this.ctx = canvas.getContext('2d');
      this.running = false;
    }
    SiriWave.prototype = {
      _globalAttenuationFn: function (x) {
        return Math.pow(this.K * 4 / (this.K * 4 + Math.pow(x, 4)), this.K * 2);
      },
      _drawLine: function (attenuation, color, width) {
        this.ctx.moveTo(0, 0);
        this.ctx.beginPath();
        this.ctx.strokeStyle = color;
        this.ctx.lineWidth = width || 1;

        var x, y;
        for (var i = -this.K; i < this.K; i += 0.01) {
          x = this.width * ((i + this.K) / (this.K * 2));
          y = this.height / 2 + this.noise * this._globalAttenuationFn(i)
                * (1 / attenuation) * Math.sin(this.F * i - this.phase);
          this.ctx.lineTo(x, y);
         }
        this.ctx.stroke();
      },
      _draw: function () {
        if (!this.running) return;

        this.phase = (this.phase + this.speed) % (Math.PI * 64);
        this._clear();
        this._drawLine(-2, 'rgba(255,255,255,0.1)');
        this._drawLine(-6, 'rgba(255,255,255,0.2)');
        this._drawLine(4, 'rgba(255,255,255,0.4)');
        this._drawLine(2, 'rgba(255,255,255,0.6)');
        this._drawLine(1, 'rgba(255,255,255,1)');

        requestAnimationFrame(this._draw.bind(this), 1000);
      },
      _clear: function () {
        this.ctx.globalCompositeOperation = 'destination-out';
        this.ctx.fillRect(0, 0, this.width, this.height);
        this.ctx.globalCompositeOperation = 'source-over';
      },
      start: function () {
        this.phase = 0;
        this.running = true;
        this._draw();
      },
      stop: function () {
        this.running = false;
        this._clear();
      },
      setNoise: function (v) {
        this.noise = Math.min(v, 1) * this.MAX;
      },
      setSpeed: function (v) {
        this.speed = v;
      },
      set: function (noise, speed) {
        this.setNoise(noise);
        this.setSpeed(speed);
      }
    };

    var wave = new SiriWave({
      width: 640,
      height: 200
    });
    wave.setNoise(0.5);
    wave.setSpeed(0.01);
    wave.start();

    var range = document.getElementById('range');
    range.addEventListener('change', function () {
      wave.setNoise(range.value);
    });
  </script>
</body>
</html>
